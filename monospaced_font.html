<!DOCTYPE html>	<html lang="en">		<head>		  <title>Games Craft</title>		  <meta charset="utf-8">		  <meta name="viewport" content="width=device-width, initial-scale=1">		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">		  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>		  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>		  <link rel="stylesheet" type="text/css" href="style.css">		</head><nav class="navbar navbar-default" style="background-color: white; color: #f5f6f7;">	  <div class="container">	    <div class="navbar-header">	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	      </button>	      <a class="navbar-left" href="./index.html#"><img style="width: 3cm;" src="./photos/logo.png"></a>	    </div>	    <div class="collapse navbar-collapse" id="myNavbar">	      <ul class="nav navbar-nav navbar-right"  style="margin-top: 25px;">	        <li><a href="./index.html">Articles</a></li>			<li><a href="./minecraft_blog.html">Minecraft Blog</a></li>			<li><a href="./yoga_app.html">Yoga App</a></li>	      	<li><a href="./art.html">Art</a></li>	      </ul>	    </div>	  </div>	</nav>	<body>	<div class="container"><div class="row">
<div class="col-sm-10 col-md-12 col-lg-12">
<div class="info-card">
<h2>MonoSpaced Fonts </h2><br><p>
There are two types of spaced fonts: Monospaced & Proportional. Monospaced fonts have constant spacing between characters while proportional fonts have variable spacing between characters. Specifically given two pairs of letters, a proportional font will tell me how far I should put the second glyph relative to the first. So if the letters 'Fo' are being rendered, in a proportional font the letter 'o' could be tucked under the 'F' so would have less spacing than say the letter pair 'DO'. This spacing is reffered to as the 'kerning' in typography, and leads to better readability. Monospaced fonts on the otherhand have a constant spacing between the letters.</p>
<br><p>
<img src='./images/kerning.png' style='width: 60%;'></p>
<br><p>
<i>Kerning visual example</i></p>
<br><p>
When we're writing our own text renderer, monospaced fonts are alot easier to render than proportional fonts. Basically You just have to step an equal amount everytime you render a new letter. Monospaced fonts are still popular today, used in applications like code text-editors. They were also common in retro videogames as they required less CPU power to render them.   </p>
<br><p>
<img src='./images/pokemon.jpg' style='width: 60%;'></p>
<br><p>
<i>Monospaced font used in Pokemon on the Gameboy</i></p>
<br><p>
In this article I show you how to think about Font's in your game project and how to implement a monospaced text renderer. Let's get started!</p>
<br><hr><h3>Loading Fonts</h3><br><br><p>
Normally you start with a .ttf file (.otf etc.) that contains vector data about how to draw the letters and meta-data about the font like the kerning. From here you could try render the letters directly from their vector counter-part, however this can be complicated and slow for a realtime application like a game. Instead an intermediate bitmap is usually created of the glyphs first, then this bitmap is rendered to the screen, using UV coordinates to pick the correct glyph.</p>
<br><p>
There are multiple libraries you can use to create these intermediate bitmaps - usually reffered to as a 'Font Atlas'. Windows has it's own built in renderer. A free library commonly used is Sean Barret's 'stb_truetype'. It has multiple options - you can ask it to create a font bitmap for you (least amount of work), to getting each glyph at a time and making your own font atlas (more work but greater control). So we'll include that in our project now to get started.</p>
<br><div class="code-block-left "><span style="color: #DAB98F;">#define </span>STB_TRUETYPE_IMPLEMENTATION 
<br><span style="color: #DAB98F;">#include </span><span style="color: #DAB98F;">"stb_truetype.h"</span>
<br></div><br><p>
Then we'll have two functions: one for intializing the font bitmap, the second for drawing it. Let's add that in now.</p>
<br><div class="code-block-left ">void <span style="color: #CD950C;">initFontAtlas</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">char </span>*fontFile<span style="color: #A08563;">)</span> {
<br><br><span style='white-space: pre;'>    </span>FILE *ttfFile = <span style="color: #CD950C;">fopen</span><span style="color: #A08563;">(</span>fontFile, <span style="color: #DAB98F;">"rb"</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">fseek</span><span style="color: #A08563;">(</span>ttfFile, <span style="color: #6B8E23;">0, </span>SEEK_END<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span>long fileSize = <span style="color: #CD950C;">ftell</span><span style="color: #A08563;">(</span>fp<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Allocate the memory to store the file contents. Plus 1 for zero terminated contents.</span><br><span style='white-space: pre;'>    </span>void *ttfBuffer = <span style="color: #CD950C;">malloc</span><span style="color: #A08563;">(</span>fileSize + <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">fread</span><span style="color: #A08563;">(</span>ttfBuffer, <span style="color: #6B8E23;">1, </span>fileSize, ttfFile<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>tempBitmapWidth = <span style="color: #6B8E23;">512;
</span><br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>tempBitmapHeight = <span style="color: #6B8E23;">512;
</span><br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Allocate the CPU side image to render the glyphs to. We will then upload this to the GPU to use by our game renderer.</span><br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">char </span>*tempBitmap = <span style="color: #CD950C;">malloc</span><span style="color: #A08563;">(</span><span style="color: #CD950C;">tempBitmapWidth*tempBitmapHeight*sizeof</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">unsigned </span>char<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Meta data about the font glyphs like width and height</span><br><span style='white-space: pre;'>    </span>stbtt_bakedchar glyphData[96]; <span style="color: #7D7D7D;">// ASCII 32..126 is 95 glyphs</span><br><br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>fontHeight = <span style="color: #6B8E23;">32.0;
</span><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">stbtt_BakeFontBitmap</span><span style="color: #A08563;">(</span>ttfBuffer, <span style="color: #6B8E23;">0, </span>fontHeight, tempBitmap, tempBitmapWidth, tempBitmapHeight, <span style="color: #6B8E23;">32, </span><span style="color: #6B8E23;">96, </span>glyphData<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">free</span><span style="color: #A08563;">(</span>ttfBuffer<span style="color: #A08563;">)</span>;
<br>}
<br></div><br><p>
So far we've opened and read the .ttf file we've supplied. It then created a temporary image buffer to render the font atlas to. We also create an array to store the meta-data for each glyph. We then ask stb_truetype library to make our font atlas for us with 'stbtt_BakeFontBitmap'.</p>
<br><p>
Now that we've got out font atlas stored in 'tempBitmap', we'll upload it to the GPU now so we can use it just like other game textures. You'll notice we're passing in the flag 'GL_ALPHA', that's because the font atlas stb_truetype makes for us is 8bit per color - just the alpha value.  </p>
<br><div class="code-block-left ">{
<br><span style='white-space: pre;'>    </span>...
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Upload to the GPU now. You can change this to however you upload textures in your game engine. </span><br><span style='white-space: pre;'>    </span>GLuint texHandle;
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glGenTextures</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">1, </span>&texHandle<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glBindTexture</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, texHandle<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glTexImage2D</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, <span style="color: #6B8E23;">0, </span>GL_ALPHA, tempBitmapWidth, tempBitmapHeight, <span style="color: #6B8E23;">0, </span>GL_ALPHA, GL_UNSIGNED_BYTE, tempBitmap<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glTexParameteri</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Free our CPU side image data now</span><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">free</span><span style="color: #A08563;">(</span>tempBitmap<span style="color: #A08563;">)</span>;
<br><br>}
<br><br></div><br><p>
That's the end of that function. It creates the font atlas & uploads it to the GPU. However in order to now write text, we actually need a way to refer to this texture and the font meta-data. So we'll make a struct for this. </p>
<br><div class="code-block-left "><span style="color: #CD950C;">struct </span>Font {
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">int </span>textureHandle; <span style="color: #7D7D7D;">//NOTE: Handle to the texture on the GPU </span><br><span style='white-space: pre;'>    </span>stbtt_bakedchar glyphData[255]; <span style="color: #7D7D7D;">//NOTE: Meta data for each glyph like width and height and the uv coords in the texture atlas. In this case it's limited to be 255 characters per font. </span><br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>fontHeight;
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>startOffset;
<br><span style='white-space: pre;'>    </span>float2 fontAtlasDim;
<br>};
<br></div><br><p>
Now let's create one of these in our <i>initFontAtlas</i> function and return it. The whole complete function will now look like this.</p>
<br><div class="code-block-left ">Font <span style="color: #CD950C;">initFontAtlas</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">char </span>*fontFile<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span>Font result = {};
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Open & get size of ttf file</span><br><span style='white-space: pre;'>    </span>FILE *ttfFile = <span style="color: #CD950C;">fopen</span><span style="color: #A08563;">(</span>fontFile, <span style="color: #DAB98F;">"rb"</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>ttfFile<span style="color: #A08563;">)</span>{
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">fseek</span><span style="color: #A08563;">(</span>ttfFile, <span style="color: #6B8E23;">0, </span>SEEK_END<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>size_t fileSize = <span style="color: #CD950C;">ftell</span><span style="color: #A08563;">(</span>ttfFile<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">fseek</span><span style="color: #A08563;">(</span>ttfFile, <span style="color: #6B8E23;">0L, </span>SEEK_SET<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Allocate the memory to store the file contents. Plus 1 for zero terminated contents.</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">char </span>*ttfBuffer <span style="color: #CD950C;">= </span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">char </span>*<span style="color: #A08563;">)</span><span style="color: #CD950C;">malloc</span><span style="color: #A08563;">(</span>fileSize + <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>size_t bytesRead = <span style="color: #CD950C;">fread</span><span style="color: #A08563;">(</span>ttfBuffer, <span style="color: #6B8E23;">1, </span>fileSize, ttfFile<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Read the ttf file contents</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>bytesRead == fileSize<span style="color: #A08563;">)</span> {
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>tempBitmapWidth = <span style="color: #6B8E23;">512;
</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>tempBitmapHeight = <span style="color: #6B8E23;">512;
</span><br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>result.fontAtlasDim.x = tempBitmapWidth;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>result.fontAtlasDim.y = tempBitmapHeight;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Allocate the CPU side image to render the glyphs to. We will then upload this to the GPU to use by our game renderer.</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">char </span>*tempBitmap <span style="color: #CD950C;">= </span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">unsigned </span><span style="color: #6B8E23;">char </span>*<span style="color: #A08563;">)</span><span style="color: #CD950C;">calloc</span><span style="color: #A08563;">(</span><span style="color: #CD950C;">tempBitmapWidth*tempBitmapHeight*sizeof</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">unsigned </span>char<span style="color: #A08563;">)</span>, <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">assert</span><span style="color: #A08563;">(</span>tempBitmap<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>result.fontHeight = <span style="color: #6B8E23;">32.0;
</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>result.startOffset = <span style="color: #6B8E23;">32;
</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE:  32, 96 values denote the main ASCI alphabet - starting at [SPACE] and going to the end of the asci table. The space is important because it tells us the width of a space.</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>r = <span style="color: #CD950C;">stbtt_BakeFontBitmap</span><span style="color: #A08563;">(</span>ttfBuffer, <span style="color: #6B8E23;">0, </span>result.fontHeight, tempBitmap, tempBitmapWidth, tempBitmapHeight, <span style="color: #6B8E23;">32, </span><span style="color: #6B8E23;">96, </span>result.glyphData<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>r == <span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">printf</span><span style="color: #A08563;">(</span><span style="color: #DAB98F;">"ERROR: Couldn't render font atlas\n"</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">assert</span><span style="color: #A08563;">(</span>false<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>} 
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Upload to the GPU now. You can change this to however you upload textures in your game engine. </span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glGenTextures</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">1, </span>&result.textureHandle<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">renderCheckError</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glBindTexture</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, result.textureHandle<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">renderCheckError</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glTexImage2D</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, <span style="color: #6B8E23;">0, </span>GL_RED, tempBitmapWidth, tempBitmapHeight, <span style="color: #6B8E23;">0, </span>GL_RED, GL_UNSIGNED_BYTE, tempBitmap<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">renderCheckError</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glTexParameteri</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">renderCheckError</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">glBindTexture</span><span style="color: #A08563;">(</span>GL_TEXTURE_2D, <span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span>; <span style="color: #7D7D7D;">//NOTE: Unbind the texture </span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">renderCheckError</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Free our CPU side image data now</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">free</span><span style="color: #A08563;">(</span>tempBitmap<span style="color: #A08563;">)</span>; 
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>} <span style="color: #CD950C;">else </span>{
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">printf</span><span style="color: #A08563;">(</span><span style="color: #DAB98F;">"bytesRead: %ld\n"</span>, bytesRead<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">assert</span><span style="color: #A08563;">(</span>false<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">free</span><span style="color: #A08563;">(</span>ttfBuffer<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span>} <span style="color: #CD950C;">else </span>{
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">assert</span><span style="color: #A08563;">(</span>false<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span>}
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">return </span>result;
<br><br>}
<br><br></div><br><h3>Using the font atlas</h3><br><br><p>
Great, now that we have the font atlas, we can now use it to render text. The second function will be called <i>renderText</i>, and this is what it does render's text.</p>
<br><div class="code-block-left ">void <span style="color: #CD950C;">renderText</span><span style="color: #A08563;">(</span>Renderer *renderer, Font *font, <span style="color: #6B8E23;">char </span>*nullTerminatedString, float2 start, <span style="color: #6B8E23;">float </span>scale<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>x = start.x;
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>y = start.y;
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">while </span><span style="color: #A08563;">(</span>*nullTerminatedString<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>*nullTerminatedString != '\n'<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if </span><span style="color: #A08563;">(</span>*nullTerminatedString &gt;= <span style="color: #6B8E23;">32 </span>&& *nullTerminatedString &lt; <span style="color: #6B8E23;">126</span><span style="color: #A08563;">)</span> {
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>stbtt_aligned_quad q  = {};
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">int </span>index = *nullTerminatedString - font-&gt;startOffset;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">stbtt_GetBakedQuad</span><span style="color: #A08563;">(</span>font-&gt;glyphData, font-&gt;fontAtlasDim.x, font-&gt;fontAtlasDim.y, index, &x, &y, &q, <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>width = q.x1 - q.x0;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>height = q.y1 - q.y0;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>x1 = <span style="color: #6B8E23;">0.5f*width </span>+ q.x0;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>y1 = <span style="color: #6B8E23;">0.5f*height </span>+ q.y0;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>x1 <span style="color: #CD950C;">= </span><span style="color: #A08563;">(</span><span style="color: #CD950C;">scale*</span><span style="color: #A08563;">(</span>x1 - start.x<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span> + start.x;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>y1 <span style="color: #CD950C;">= </span><span style="color: #A08563;">(</span><span style="color: #CD950C;">scale*</span><span style="color: #A08563;">(</span>y1 - start.y<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span> + start.y;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>float4 uvCoords = <span style="color: #CD950C;">make_float4</span><span style="color: #A08563;">(</span>q.s0, q.s1, q.t1, q.t0<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">pushGlyph</span><span style="color: #A08563;">(</span>renderer, <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span>x1, y1, <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>, <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span>scale*width, scale*height, <span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span>, uvCoords, <span style="color: #CD950C;">make_float4</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">1, </span><span style="color: #6B8E23;">1, </span><span style="color: #6B8E23;">1, </span><span style="color: #6B8E23;">1</span><span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>} <span style="color: #CD950C;">else </span>{
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Move down a line</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>x = start.x;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>y += font-&gt;fontHeight;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>nullTerminatedString++;
<br><span style='white-space: pre;'>    </span>}
<br>}
<br></div><br><p>
It walks through each character in the string and gets the corresponding glyph bitmap. stbtt_GetBakedQuad returns the size & position of the glyph given where we would like to render it.</p>
<br><p>
Once we've got this info i.e. the (x, y) position and the (width, height) data we can send this to our renderer. The pushGlyph function is a function we've defined in our own custom renderer and it's up to you to implement this. </p>
<br><p>
Since we have only created ASCI characters when we created our font atlas, we make sure we only ever ask to draw these characters with the 'if' statment:</p>
<br><div class="code-block-left "><span style="color: #CD950C;">if </span><span style="color: #A08563;">(</span>*nullTerminatedString &gt;= <span style="color: #6B8E23;">32 </span>&& *nullTerminatedString &lt; <span style="color: #6B8E23;">126</span><span style="color: #A08563;">)</span>
<br></div><br><p>
To extend this to full unicode character set, you'll have to extend how the font atlas treats characters it hasn't yet renderered into it's bitmap. You'll have to create them as it encouter's them, then caches them to use again. </p>
<br><hr><h3>Go Further</h3><br><br><p>
1. Extend this to handle more then just Asci glyphs.</p>
<br><p>
2. Be hable to decode utf-8 strings to get correct unicode codepoint - right now our 'renderText' function assumes each character is one byte i.e. Asci</p>
<br><p>
3. Support kerning - add a kerning table for each codepoint pair.</p>
<br><p>
4. Render using SDF data instead of a bitmap</p>
<br><br></div>
</div>
</div>
<br><br></div></body></html><script src='email.js'></script>