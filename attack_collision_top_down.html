<!DOCTYPE html>	<html lang="en">		<head>		  <title>Games Craft</title>		  <meta charset="utf-8">		  <meta name="viewport" content="width=device-width, initial-scale=1">		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">		  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>		  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>		  <link rel="stylesheet" type="text/css" href="style.css">		</head><nav class="navbar navbar-default" style="background-color: white; color: #f5f6f7;">	  <div class="container">	    <div class="navbar-header">	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	      </button>	      <a class="navbar-left" href="./index.html#"><img style="width: 3cm;" src="./photos/logo.png"></a>	    </div>	    <div class="collapse navbar-collapse" id="myNavbar">	      <ul class="nav navbar-nav navbar-right"  style="margin-top: 25px;">	        <li><a href="./articles.html">Articles</a></li>	      </ul>	    </div>	  </div>	</nav>	<body>	<div class="container"><div class="row">
<div class="col-sm-10 col-md-12 col-lg-12">
<div class="info-card">
<h2>Collision for attacking enemies</h2><br><h3>25th September 2024</h3><br><br><p>
So far in my 2d top down game I've created a player and enemy entities. I'm now finishing the attack between them. This involves: working out when there's a collision between them, playing the correct animation, dealing damage & knocking them back from the attack. The hardest out of these is working out the collision between them.</p>
<br><p>
The simplest method is to have an box around them, and if they overlap we should do something. I've separated the game engine into two parts: collision & physics update & the entity gameplay update. This is so we can do frame independent physics easily & by coupling collision detection with the physics update, we avoid the problem of tunnelling - that is an entity passes through another but each frame occurs either side of it, so we never detect a collision. </p>
<br><p>
The downside to doing it this way is that we're storing all collision events prior to using them instead of just acting on the collision straight away (retained mode vs immediate mode response) which adds memory usage.  But we also get tracking of the state of the collision event: is it Enter, Stay or an Exit event? Which can be handy for writing gameplay code. </p>
<br><p>
I'll keep it as it is until I reach a point where it no longer works: either gameplay wise or performance wise. </p>
<br><p>
Once we have processed the collision, the rest is easy. In the update entity function, we check if there was an enter or stay collision by an enemy on the player and the enemy is attacking (if the enemy was just wandering or hurt itself, we don't want to penaltise the player). If this check idms true, reduce health, play the hurt animation, and add an impulse force to the player to give some feedback to the player. </p>
<br><div class="code-block-left "><span style="color: #CD950C;">updateEntity</span><span style="color: #A08563;">(</span>Entity *e<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>e-&gt;type == ENTITY_PLAYER<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>Collider c = e-&gt;colliders[HIT_COLLIDER_INDEX];
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Check if anything hit this collider</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>c.collideEventsCount &gt; <span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Loop through all the collision events</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">for</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">int </span>i = <span style="color: #6B8E23;">0; </span>i &lt; c.collideEventsCount; ++i<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">const </span>CollideEvent event = c.events[i];  
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span><span style="color: #A08563;">(</span>event.type == COLLIDE_STAY || event.type == COLLIDE_ENTER<span style="color: #A08563;">)</span> && event.entityType == ENTITY_ENEMY && event.damage &gt; <span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Hit by enemy - decrement health</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>e-&gt;health -= event.damage;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Apply knockback impulse to give feedback to player </span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>e-&gt;velocity.xy = <span style="color: #CD950C;">plus_float2</span><span style="color: #A08563;">(</span>e-&gt;velocity.xy, <span style="color: #CD950C;">scale_float2</span><span style="color: #A08563;">(</span>hitForce, event.hitDir<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span>...
<br>}
<br></div><br><p>
An entity can have multiple colliders on it for different purposes. In this case the player has a collider in the slot 'HIT_COLLIDER_INDEX' that's been designated for the hurt box. To know whether an enemy is actually attacking, we check whether the collider event contains damage to apply to the player.</p>
<br><video controls="controls" width="800" height="600" type="video/webm" name="attack bat">
  <source src="./images/attack_bat.webm">
</video>
</div><br><a target='_blank' href='https://github.com/Olster1/adventure_game'><div style='background-color: #FFE5B4; border-radius: 0.5cm; padding: 0.5cm;'> You can see the codebase here ðŸ‘†</div></a><br><br></div>
</div>
</div>
<br><br></div></body></html><script src='email.js'></script>