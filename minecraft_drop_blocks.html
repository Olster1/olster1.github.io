<!DOCTYPE html>	<html lang="en">		<head>		  <title>Games Craft</title>		  <meta charset="utf-8">		  <meta name="viewport" content="width=device-width, initial-scale=1">		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">		  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>		  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>		  <link rel="stylesheet" type="text/css" href="style.css">		</head><nav class="navbar navbar-default" style="background-color: white; color: #f5f6f7;">	  <div class="container">	    <div class="navbar-header">	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	        <span class="icon-bar"></span>	      </button>	      <a class="navbar-left" href="./index.html#"><img style="width: 3cm;" src="./photos/logo.png"></a>	    </div>	    <div class="collapse navbar-collapse" id="myNavbar">	      <ul class="nav navbar-nav navbar-right"  style="margin-top: 25px;">	        <li><a href="./articles.html">Articles</a></li>	      </ul>	    </div>	  </div>	</nav>	<body>	<div class="container"><div class="row">
<div class="col-sm-10 col-md-12 col-lg-12">
<div class="info-card">
<h2>Drop Blocks</h2><br><p>
In minecraft when you mine a block, it drops the block to pick up. These blocks have to respond to what blocks are around them: if you put a block ontop of them, they have to move out of the way. They also have to fall with gravity.</p>
<br><p>
I thought about how to solve this and went about the easiest and simplest solution. Each update loop the pickup block checks if it's inside a block, it it is, find the closest free block around it. I only check a 3 x 3 x 3 square i.e. one block from the block they're on. If no free block is found, just try to move upward. In code it looks like this: </p>
<br><div class="code-block-left ">float3 <span style="color: #CD950C;">findClosestFreePosition</span><span style="color: #A08563;">(</span>GameState *gameState, float3 startP, float3 defaultDir<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span>float3 result = defaultDir;
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>closestDist = FLT_MAX;
<br><span style='white-space: pre;'>    </span>float3 startP_block = <span style="color: #CD950C;">convertRealWorldToBlockCoords</span><span style="color: #A08563;">(</span>startP<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">bool </span>found = false;
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">for</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">int </span>z = <span style="color: #6B8E23;">-1; </span>z &lt;= <span style="color: #6B8E23;">1; </span>z++<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">for</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">int </span>y = <span style="color: #6B8E23;">-1; </span>y &lt;= <span style="color: #6B8E23;">1; </span>y++<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">for</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">int </span>x = <span style="color: #6B8E23;">-1; </span>x &lt;= <span style="color: #6B8E23;">1; </span>x++<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>x == <span style="color: #6B8E23;">0 </span>&& y == <span style="color: #6B8E23;">0 </span>&& z == <span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Don't test the block we're in</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>continue;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>} <span style="color: #CD950C;">else </span>{
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>float3 offset = <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span>x, y, z<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>float3 blockP = <span style="color: #CD950C;">plus_float3</span><span style="color: #A08563;">(</span>offset, startP_block<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>BlockChunkPartner blockPtr = <span style="color: #CD950C;">blockExists</span><span style="color: #A08563;">(</span>gameState, blockP.x, blockP.y, blockP.z, BLOCK_EXISTS_COLLISION<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>!blockPtr.block<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>float3 dirVector = <span style="color: #CD950C;">minus_float3</span><span style="color: #A08563;">(</span>blockP, startP<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #6B8E23;">float </span>d = <span style="color: #CD950C;">float3_magnitude_sqr</span><span style="color: #A08563;">(</span>dirVector<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span>d &lt; closestDist<span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>result = dirVector;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>closestDist = d;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>found = true;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>}
<br><span style='white-space: pre;'>    </span>}
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">return </span>result;
<br>}
<br></div><br><hr><h3>Entity Update </h3><br><br><p>
Now that we have 'findClosestFreePosition' we can use it in the pickup block update function.</p>
<br><div class="code-block-left ">void <span style="color: #CD950C;">updatePickupBlock</span><span style="color: #A08563;">(</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span>float3 accelForFrame = <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Convert the floating point position to which block it is inside</span><br><span style='white-space: pre;'>    </span>float3 worldP = <span style="color: #CD950C;">convertRealWorldToBlockCoords</span><span style="color: #A08563;">(</span>e-&gt;T.pos<span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span><span style="color: #CD950C;">blockExistsReadOnly</span><span style="color: #A08563;">(</span>gameState, worldP.x, worldP.y, worldP.z, BLOCK_EXISTS_COLLISION<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Pickup block is inside another block so moveout of the way</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>float3 moveDir = <span style="color: #CD950C;">findClosestFreePosition</span><span style="color: #A08563;">(</span>gameState, e-&gt;T.pos, <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">1, </span><span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span>, gameState-&gt;searchOffsets, <span style="color: #CD950C;">arrayCount</span><span style="color: #A08563;">(</span>gameState-&gt;searchOffsets<span style="color: #A08563;">)</span>, <span style="color: #CD950C;">arrayCount</span><span style="color: #A08563;">(</span>gameState-&gt;searchOffsets<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>moveDir = <span style="color: #CD950C;">normalize_float3</span><span style="color: #A08563;">(</span>moveDir<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>e-&gt;dP = <span style="color: #CD950C;">make_float3</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">0</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>accelForFrame = <span style="color: #CD950C;">plus_float3</span><span style="color: #A08563;">(</span>accelForFrame, <span style="color: #CD950C;">scale_float3</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">100.0f, </span>moveDir<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: DEBUG code to place a red block if we are colliding. This is a helpful debug aid</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #CD950C;">pushAlphaCube</span><span style="color: #A08563;">(</span>gameState-&gt;renderer, worldP, BLOCK_CLOUD, <span style="color: #CD950C;">make_float4</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">1, </span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">0, </span><span style="color: #6B8E23;">1.0f</span><span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span>} <span style="color: #CD950C;">else </span><span style="color: #CD950C;">if</span><span style="color: #A08563;">(</span><span style="color: #CD950C;">!blockExistsReadOnly</span><span style="color: #A08563;">(</span>gameState, worldP.x, worldP.y <span style="color: #6B8E23;">-1 </span>, worldP.z, BLOCK_EXISTS_COLLISION<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span> {
<br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: check if should apply gravity</span><br><span style='white-space: pre;'>    </span><span style='white-space: pre;'>    </span>accelForFrame.y = <span style="color: #6B8E23;">-10;
</span><br><span style='white-space: pre;'>    </span>}
<br><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Integrate acceleration</span><br><span style='white-space: pre;'>    </span>e-&gt;dP = <span style="color: #CD950C;">plus_float3</span><span style="color: #A08563;">(</span>e-&gt;dP, <span style="color: #CD950C;">scale_float3</span><span style="color: #A08563;">(</span>gameState-&gt;dt, accelForFrame<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>; <span style="color: #7D7D7D;">//NOTE: Already * by dt </span><br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Apply drag</span><br><span style='white-space: pre;'>    </span>e-&gt;dP = <span style="color: #CD950C;">scale_float3</span><span style="color: #A08563;">(</span><span style="color: #6B8E23;">0.95f, </span>e-&gt;dP<span style="color: #A08563;">)</span>;
<br><span style='white-space: pre;'>    </span><span style="color: #7D7D7D;">//NOTE: Integrate velocity</span><br><span style='white-space: pre;'>    </span>e-&gt;T.pos = <span style="color: #CD950C;">plus_float3</span><span style="color: #A08563;">(</span>e-&gt;T.pos, <span style="color: #CD950C;">scale_float3</span><span style="color: #A08563;">(</span>gameState-&gt;dt, e-&gt;dP<span style="color: #A08563;">)</span><span style="color: #A08563;">)</span>;
<br>}
<br></div><br><video controls="controls" width="800" height="600" type="video/webm" name="Drop Blocks">
  <source src="./images/dropBlocks.webm">
</video>
</div><br><a target='_blank' href='https://github.com/Olster1/minecraft_clone'><div style='background-color: #FFE5B4; border-radius: 0.5cm; padding: 0.5cm;'> You can see the codebase here ðŸ‘†</div></a><br><br></div>
</div>
</div>
<br><br></div></body></html><script src='email.js'></script>